/*=====================================================================*/
/*    serrano/prgm/project/hiphop/hhmqtt/hhmqtt/src/mqtt.hh.ts         */
/*    -------------------------------------------------------------    */
/*    Author      :  Manuel Serrano                                    */
/*    Creation    :  Thu Apr  4 09:07:35 2024                          */
/*    Last change :  Thu Apr  4 13:27:13 2024 (serrano)                */
/*    Copyright   :  2024 Manuel Serrano                               */
/*    -------------------------------------------------------------    */
/*    HipHop MQTT                                                      */
/*=====================================================================*/

/*---------------------------------------------------------------------*/
/*    The module                                                       */
/*---------------------------------------------------------------------*/
import { ReactiveMachine } from "@hop/hiphop";
export { mach };

/*---------------------------------------------------------------------*/
/*    zigbee2mqtt                                                      */
/*---------------------------------------------------------------------*/
hiphop interface zigbee2mqtt {
   in ${"zigbee2mqtt/bridge/devices"};
}

/*---------------------------------------------------------------------*/
/*    mqtt ...                                                         */
/*---------------------------------------------------------------------*/
const mqtt = hiphop module() implements zigbee2mqtt {
   in message;

   pragma { console.log("machine ready..."); }
   every (message.now) {
      pragma { console.log("MSG=", message.nowval.toString()); }
   }
}

/*---------------------------------------------------------------------*/
/*    mach ...                                                         */
/*---------------------------------------------------------------------*/
const mach = new ReactiveMachine(mqtt, { name: "mqtt" });
